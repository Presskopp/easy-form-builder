
/* 
 Created by : Hassan Tafreshi
 Copy right owner : whiteStudio.team
 Desc: This multi-select is designed base on boostrap 5 and used for Easy form builder Wordpress Plugin
 */

 let idOfMenu_efb ="";
 let default_val_efb ="Select an Option";
 let inputSearch_efb;
 let ArrSearch_efb = Array.prototype;
//data-id va data=setid bari baghi bejoz Elicon iki bashad va id bashad

 function returnValueSelectedOfListEfb(dataSetId){
     
     const l = document.querySelector(`[data-idset="${dataSetId}"].efb.efblist.inplist`)
     //console.log(l);
     let s = l.dataset.select.split(',');
     s= s.slice(0,(s.length-1))
     let r =''
     s.forEach(element => {
         const d = document.querySelector(`.efb.table.${dataSetId}`)
     
         let v= d.querySelector(`[data-row="${element}"]`)
         r += v.dataset.name +', '
     });
     r=r.slice(0,(r.length-2));
     //console.log(r);
     return r;
 }
 function returnValueSelectedOfIconEfb(dataSetId){
     //select icon
     const l = document.querySelector(`[data-idset="${dataSetId}"].efb.efblist.inplist`)
     //console.log(l);
     let r = l.dataset.select
     const icon = `bi-${bootstrap_icons[r]}`
     //console.log(r,icon);
     return icon;
 }


 function onInputEventEFB(e) {
     inputSearch_efb = e;    
     var table1 = document.querySelector(`.${e.dataset.id}.table` );
        ArrSearch_efb.forEach.call(table1.tBodies, function(tbody) {
             ArrSearch_efb.forEach.call(tbody.rows, filterTable_efb);
         });
 }
 
 function filterTable_efb(row) {
     var text = row.textContent.toLowerCase();
    var val = inputSearch_efb.value.toLowerCase();
   row.style.display = text.indexOf(val) === -1 ? 'none' : 'table-row';
 }
 
 
 function FunSearchTableEfb(dataSetId){
     let inputs =document.querySelector(`[data-id="${dataSetId}"].searchBox` );
      onInputEventEFB(inputs)
 }
 
  document.addEventListener("click", (evnt) => {
      const d=evnt.target.dataset.id;

      IsmenuC=(el)=>{
       let id      
        while (id!='wpbody-content' && id!='sideMenuFEfb') {
          el=el.parentNode;
          id= el["id"]!=undefined ? el.id :'no' ;
        }
        return id;
      }      
      if(document.getElementById('sideBoxEfb') && document.getElementById('sideBoxEfb').classList.contains('show') 
      && evnt.target.id!="BtnCSideEfb" && !evnt.target.classList.contains('BtnSideEfb') && !evnt.target.classList.contains('wp-toolbar')){                 
        let id=IsmenuC(evnt.target);
        if(id=="wpbody-content") sideMenuEfb(0)
      }
      
      if(evnt.target.classList.contains('efblist')){
        //if(evnt.target.classList.contains('disabled')==true){console.log('dieMenu');return 0;}
          if(idOfMenu_efb!=d){
              if(idOfMenu_efb.length>1){
                 c_m_efb();
              }else{
                 idOfMenu_efb =d;
                 a_m_efb();
              }
          }else{
              if(evnt.target.dataset.parent){
                 c_m_efb();
              }
          }
         
      }else if (evnt.target.tagName=="TD" ||evnt.target.tagName=="TH"  ){
          
          console.log(idOfMenu_efb)
       const e =evnt.target.parentNode 
         if(e.classList.contains('efblist')){
            
             let l =  document.querySelector(`[data-id="${idOfMenu_efb}"]`);
             console.log(l.dataset);
             if(l.dataset.no==1){
                 let fc = e.querySelector("TH")
                 if(e.dataset.row ==l.dataset.select){
                     l.dataset.select="" ;
                     l.innerHTML=default_val_efb;
                     x.classList.remove("border-info"); 
                    if (l.dataset.icon==1) fc.className="bi-square";
                 }else{
                    
                     if(l.dataset.select.length>0) {
                         let x= document.querySelector(`[data-id="${idOfMenu_efb}"] [data-row="${l.dataset.select}"]`);
                         x.classList.remove("border-info");                
                         if (l.dataset.icon==1) x.querySelector("TH").className="bi-square";  
                     }
                     l.dataset.select=e.dataset.row;
                     l.innerHTML=e.dataset.name;
                     console.log(l.dataset)
                     if (l.dataset.icon==1) fc.className="bi-check-square text-info";
                     e.className += " border-info";
                 }
                 c_m_efb();
             }else{

                 const r= e.dataset.row;
                 let fc = e.querySelector("TH")
                 //console.log(r, l.dataSetId)
                 if(l.dataset.select.includes(r)){

                     l.dataset.select= l.dataset.select.replace(`${r},`, '');
                     const v= l.innerHTML.length == (l.innerHTML.indexOf(',')+1) ? default_val_efb :''
                     l.innerHTML =  l.innerHTML.replace(`${e.dataset.name},`,v);
                     if (l.dataset.icon==1) fc.className="bi-square";
                     e.className="efblist"
                 }else{
                    const s= l.dataset.select.split(",");
                     if((s.length)<=l.dataset.no){
                         if (l.dataset.icon==1) fc.className="bi-check-square text-info";
                         l.dataset.select.length<1 ?  l.innerHTML=e.dataset.name+"," :l.innerHTML+=e.dataset.name+","
                         l.dataset.select+=`${e.dataset.row},`;
                         e.className += " border-info";
 
                     }

                 }
           
             }   
             //console.log(l.id);
             switch(l.id){
                 case "iconEl":
                         //console.log(l.dataset)
                        set_icon_valEfb(l)
                    break;
                 }
               
                
         }else{
             if(idOfMenu_efb.length>1){
                 c_m_efb();
             }
         }
      }else if (idOfMenu_efb!=""){
         c_m_efb();
      }
  });
 
  const c_m_efb=()=>{
     //hide the list select
        let m = document.querySelector(`[data-list="${idOfMenu_efb}"]`);        
        m.classList.add("d-none");
        idOfMenu_efb="";
       }
   const a_m_efb=()=>{
       //Show the list select
        let m = document.querySelector(`[data-list="${idOfMenu_efb}"]`);
        m.classList.remove("d-none");
       }

 const set_icon_valEfb=(el)=>{

    let di = '';
    const idset=el.dataset.idset.includes("step-")?el.dataset.idset.slice(5) : el.dataset.idset;
    //console.log(el.dataset.idset.includes("step-"), el.dataset,idset)
    const indx = idset!="button_group_" ? valj_efb.findIndex(x=>x.id_ ==idset) : 0
    let icon=""
    //console.log(idset,indx)
    //console.log(valj_efb[indx]);
    if (el.dataset.side == "undefined" || el.dataset.side == "") {
      di = indx!=0 ? `${valj_efb[indx].id_}_icon`:'button_group_icon'
      const k  = isNumericEfb(idset)  ? 'step-'+idset : idset
      icon= valj_efb[indx].icon = returnValueSelectedOfIconEfb(k);
    } else {
      const i = returnValueSelectedOfIconEfb(idset);
      icon=i
      //console.log(`i====================>${i} ${el.dataset.side}` ,`=========================>${el.dataset.side.includes("Next")}`);
      di = el.dataset.side.includes("Next") ? `button_group_Next_icon` : `button_group_Previous_icon`
      el.dataset.side.includes("Next") ? valj_efb[0].button_Next_icon = i : valj_efb[0].button_Previous_icon = i
    }
    //console.log(di);
    //Bug replace find bi-XXXXX in class
   
    const r =iconChangerEfb(document.getElementById(`${di}`).className,icon)
    //console.log(r);
    document.getElementById(`${di}`).className =r
 }
 
 